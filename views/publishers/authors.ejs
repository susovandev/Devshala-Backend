<!DOCTYPE html>
<html lang="en">
<%- include("../partials/head.ejs") %>

<body class="bg-gray-100 min-h-screen">
<%- include("../partials/toast.ejs") %>

<div class="flex min-h-screen">

  <!-- SIDEBAR -->
  <%- include("./components/sidebar.ejs", {currentPath, publisher, pageTitle}) %>

  <!-- MAIN -->
  <div class="flex-1 flex flex-col">
<%- include("./components/main-header.ejs", {publisher, totalUnreadNotifications, totalNotifications, notifications}) %>

    <main class="flex-1 p-6 space-y-6">

      <div class="flex items-center justify-between">
    <div>
      <h2 class="text-2xl font-semibold text-gray-800">Author Management</h2>
      <p class="text-sm text-gray-500">
        Create, Disabled, Blocked and Activate authors
      </p>
    </div>

    <!-- CREATE CATEGORY BUTTON -->
    <button
  data-open-modal="create-category"
  class="bg-indigo-600 text-white px-5 py-2.5 rounded-xl text-sm font-medium shadow
         hover:bg-indigo-700 transition flex items-center gap-2"
>
  <i class="fa-solid fa-plus"></i>
  New Author
</button>

  </div>

      <!-- HEADER -->


      <!-- TABLE -->
      <div class="bg-white rounded-2xl shadow border overflow-hidden">
        <table class="w-full text-sm">
          <thead class="bg-gray-50 text-gray-600">
            <tr>
              <th class="px-6 py-4 text-left">Author</th>
              <th class="px-6 py-4 text-left">Status</th>
              <th class="px-6 py-4 text-left">Total Blogs</th>
              <th class="px-6 py-4 text-left">Joined</th>
              <th class="px-6 py-4 text-right">Actions</th>
            </tr>
          </thead>

          <tbody class="divide-y">

          <% if (!authors.docs.length) { %>
            <tr>
              <td colspan="5" class="px-6 py-16 text-center text-gray-500">
                No authors found
              </td>
            </tr>
          <% } else { %>

          <% authors.docs.forEach(author => { %>
            <tr class="hover:bg-gray-50">

              <!-- AUTHOR -->
              <td class="px-6 py-4 flex items-center gap-3">
                <img
                  src="<%= author.avatarUrl.url || `https://ui-avatars.com/api/?name=${author.username}` %>"
                  class="w-10 h-10 rounded-full object-cover"
                />
                <div>
                  <p class="font-medium"><%= author.username %></p>
                  <p class="text-xs text-gray-500"><%= author.email %></p>
                </div>
              </td>

              <!-- STATUS -->
              <td class="px-6 py-4">
                <% if (author.status === 'ACTIVE') { %>
                  <span class="px-3 py-1 text-xs rounded-full bg-green-100 text-green-700">
                    ACTIVE
                  </span>
                <% } else if (author.status === 'DISABLED') { %>
                  <span class="px-3 py-1 text-xs rounded-full bg-yellow-100 text-yellow-700">
                    DISABLED
                  </span>
                <% } else { %>
                  <span class="px-3 py-1 text-xs rounded-full bg-red-100 text-red-700">
                    BLOCKED
                  </span>
                <% } %>
              </td>

              <!-- BLOG COUNT -->
              <td class="px-6 py-4">
                <span class="bg-indigo-50 text-indigo-600 px-3 py-1 rounded-full text-xs">
                  <%= author.blogCount || 0 %> Blogs
                </span>
              </td>

              <!-- DATE -->
              <td class="px-6 py-4 text-gray-500">
                <%= author.createdAt.toDateString() %>
              </td>

              <!-- ACTIONS -->
              <td class="px-6 py-4 text-right space-x-3">

  <% if (author.status !== 'ACTIVE') { %>
    <form
      action="/publishers/author/manage/<%= author._id %>/activate"
      method="POST"
      class="inline-block"
    >
      <button
      type="submit"
      class="flex items-center gap-2 px-4 py-1.5
             text-sm font-semibold text-green-700
             bg-green-50 border border-green-200
             rounded-lg
             hover:bg-green-100 hover:border-green-300
             focus:outline-none focus:ring-2 focus:ring-green-400
             transition"
    >
      <!-- optional icon -->
      <span class="text-green-600">●</span>
      Activate
    </button>
    </form>
  <% } %>

  <% if (author.status === 'ACTIVE') { %>
  <div class="flex items-center gap-2">
    
    <!-- Disable Button -->
    <button
      type="button"
      data-open-modal="reason"
      data-id="<%= author._id %>"
      data-action="disable"
      class="flex items-center gap-2 px-4 py-1.5
             text-sm font-semibold text-yellow-700
             bg-yellow-50 border border-yellow-200
             rounded-lg
             hover:bg-yellow-100 hover:border-yellow-300
             focus:outline-none focus:ring-2 focus:ring-yellow-400
             transition"
    >
      <span class="text-yellow-600">●</span>
      Disable
    </button>

    <!-- Block Button -->
    <button
      type="button"
      data-open-modal="reason"
      data-id="<%= author._id %>"
      data-action="block"
      class="flex items-center gap-2 px-4 py-1.5
             text-sm font-semibold text-red-700
             bg-red-50 border border-red-200
             rounded-lg
             hover:bg-red-100 hover:border-red-300
             focus:outline-none focus:ring-2 focus:ring-red-400
             transition"
    >
      <span class="text-red-600">●</span>
      Block
    </button>

  </div>
<% } %>


</td>

            </tr>
          <% }) %>

          <% } %>
          </tbody>
        </table>

        <!-- PAGINATION -->
        <div class="flex justify-between px-6 py-4 border-t text-sm">
          <p>Page <%= authors.page %> of <%= authors.totalPages %></p>
          <div class="flex gap-2">
            <% if (authors.hasPrevPage) { %>
                            <a
  href="?page=<%= authors.prevPage %>"
  class="inline-flex items-center px-4 py-2
         text-sm font-medium text-gray-700
         bg-white border border-gray-300
         rounded-lg
         hover:bg-gray-100
         focus:outline-none focus:ring-2 focus:ring-indigo-400
         transition"
>
  ← Prev
</a>
            <% } %>
            <% if (authors.hasNextPage) { %>
                            <a
  href="?page=<%= authors.nextPage %>"
  class="inline-flex items-center px-4 py-2
         text-sm font-medium text-gray-700
         bg-white border border-gray-300
         rounded-lg
         hover:bg-gray-100
         focus:outline-none focus:ring-2 focus:ring-indigo-400
         transition"
>
  Next →
</a>
            <% } %>
          </div>
        </div>
      </div>
    </main>

    <%- include("./components/footer.ejs") %>
  </div>
</div>


<!-- CREATE AUTHOR MODAL -->
<div id="create-author-modal"
 class="modal fixed inset-0 z-50 hidden items-center justify-center bg-black/50">

  <div class="bg-white w-full max-w-md rounded-2xl p-6">
    <h3 class="text-lg font-semibold mb-4">Create Author</h3>

    <form action="/publishers/author/manage/create" method="POST" class="space-y-4">
      <input name="username" required placeholder="Username"
        class="w-full px-4 py-2 rounded-xl border" />
      <input name="email" type="email" required placeholder="Email"
        class="w-full px-4 py-2 rounded-xl border" />

      <div class="flex justify-end gap-3">
        <button data-close-modal type="button" class="border px-4 py-2 rounded-lg">
          Cancel
        </button>
        <button class="bg-indigo-600 text-white px-4 py-2 rounded-lg">
          Create
        </button>
      </div>
    </form>
  </div>
</div>

<!-- REASON MODAL -->
<div id="reason-modal"
 class="modal fixed inset-0 z-50 hidden items-center justify-center bg-black/50">

  <div class="bg-white w-full max-w-md rounded-2xl p-6">
    <h3 id="reasonTitle" class="text-lg font-semibold mb-4"></h3>

    <form id="reasonForm" method="POST" class="space-y-4">
      <textarea
        name="reason"
        required
        placeholder="Enter valid reason..."
        class="w-full px-4 py-3 rounded-xl border resize-none"></textarea>

      <div class="flex justify-end gap-3">
        <button data-close-modal type="button" class="border px-4 py-2 rounded-lg">
          Cancel
        </button>
        <button class="bg-red-600 text-white px-4 py-2 rounded-lg">
          Confirm
        </button>
      </div>
    </form>
  </div>
</div>


<!-- CREATE AUTHOR MODEL -->
<div
   id="create-category-modal"
  class="modal fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm"
>
  <div
    class="bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 animate-scale-in"
  >
    <!-- HEADER -->
    <div class="flex items-center justify-between mb-5">
      <h3 class="text-lg font-semibold text-gray-800">
        Create Author
      </h3>
      <button
  data-open-modal="create-category"
  class="bg-indigo-600 text-white px-5 py-2.5 rounded-xl text-sm font-medium shadow
         hover:bg-indigo-700 transition flex items-center gap-2"
>
  <i class="fa-solid fa-plus"></i>
  New Author
</button>
    </div>

    <!-- FORM -->
    <form action="/publishers/author/manage/create" method="POST" class="space-y-5">

      <!-- INPUT -->
      <div>
        <label class="block text-sm font-medium text-gray-600 mb-1">
          Author Username
        </label>

        <div class="relative">
          <input
            type="text"
            name="username"
            required
            placeholder="e.g. author984"
            class="w-full rounded-xl border border-gray-300 bg-white px-4 py-3
                   text-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200
                   transition"
          />
          <i class="fa-solid fa-user absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
      </div>

      <!-- INPUT -->
       <div>
        <label class="block text-sm font-medium text-gray-600 mb-1">
          Author Email
        </label>

        <div class="relative">
          <input
            type="email"
            name="email"
            required
            placeholder="e.g. author@gmail.com"
            class="w-full rounded-xl border border-gray-300 bg-white px-4 py-3
                   text-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200
                   transition"
          />
          <i class="fa-solid fa-envelope absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
      </div>

      <!-- ACTIONS -->
      <div class="flex justify-end gap-3 pt-3">
        <button
          type="button"
          data-close-modal
          class="px-4 py-2 rounded-lg border border-gray-300 text-gray-600
                 hover:bg-gray-100 transition"
        >
          Cancel
        </button>

        <button
          type="submit"
          class="px-5 py-2 rounded-lg bg-indigo-600 text-white
                 hover:bg-indigo-700 transition font-medium"
        >
          Create Author
        </button>
      </div>
    </form>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {

  const reasonForm = document.getElementById('reasonForm');
  const reasonTitle = document.getElementById('reasonTitle');

  document.querySelectorAll('[data-open-modal]').forEach(btn => {
    btn.addEventListener('click', () => {

      const modal = document.getElementById(`${btn.dataset.openModal}-modal`);

      // reset previous input
      reasonForm.reset();

      if (btn.dataset.action && btn.dataset.id) {
        const action = btn.dataset.action;
        const id = btn.dataset.id;

        reasonTitle.innerText =
          action === 'block' ? 'Block Author' : 'Disable Author';

        // ✅ ABSOLUTE + CORRECT ROUTE
        reasonForm.action =
          `/publishers/author/manage/${id}/${action}`;
      }

      modal.classList.remove('hidden');
      modal.classList.add('flex');
    });
  });

  document.querySelectorAll('[data-close-modal]').forEach(btn => {
    btn.addEventListener('click', () => {
      const modal = btn.closest('.modal');
      modal.classList.add('hidden');
      modal.classList.remove('flex');
    });
  });

});
</script>

    <%- include('../partials/toast-script.ejs') %>
    <%- include("./components/icon-hover.ejs") %>
    <%- include("./components/back-button.ejs") %>
    <%- include("./components/real-time.ejs") %>



</body>
</html>