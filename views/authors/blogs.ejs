<!DOCTYPE html>
<html lang="en">
  <%- include("../partials/head.ejs", {title}) %>

  <body class="bg-gray-100 min-h-screen">
    <%- include("../partials/toast.ejs") %>
    <div class="flex min-h-screen">
      <!-- SIDEBAR -->
      <%- include("./components/sidebar.ejs", {currentPath, author, pageTitle}) %>

      <!-- MAIN AREA -->
      <div class="flex-1 flex flex-col">
        <!-- TOP BAR -->
<%- include("./components/main-header.ejs", {author, totalUnreadNotifications, totalNotifications, notifications}) %>

        <!-- MAIN CONTENT -->
        <main class="p-6 space-y-6">
          <!-- HEADER -->
          <div class="flex items-center justify-between">
            <div>
              <h1 class="text-2xl font-semibold text-gray-800">My Blogs</h1>
              <p class="text-sm text-gray-500">
                Track performance and approval status of your blogs
              </p>
            </div>

            <!-- CREATE BLOG (ONLY ACTION AUTHOR HAS) -->
            <a
              href="/authors/blogs/create"
              class="inline-flex items-center gap-2 px-5 py-2.5 rounded-xl bg-indigo-600 text-white text-sm font-semibold hover:bg-indigo-700 transition shadow"
            >
              <i class="fa-solid fa-pen"></i>
              Create Blog
            </a>
          </div>

          <!-- TABLE CARD -->
          <div class="bg-white rounded-2xl border shadow overflow-hidden">

    <table class="w-full text-sm">
      <thead class="bg-gray-50 text-gray-600">
        <tr>
          <th class="px-6 py-4 text-left">Blog</th>
          <th class="px-6 py-4 text-left">Categories</th>
          <th class="px-6 py-4 text-center">Status</th>
          <th class="px-6 py-4 text-center">Stats</th>
          <th class="px-6 py-4 text-center">Action</th>
        </tr>
      </thead>

      <tbody class="divide-y">

        <% if (!blogs.docs.length) { %>
          <tr>
            <td colspan="5" class="py-20 text-center text-gray-500">
              No blogs found
            </td>
          </tr>
        <% } %>

        <% blogs.docs.forEach(blog => { %>
          <tr class="hover:bg-gray-50 transition">

            <!-- BLOG -->
            <td class="px-6 py-4">
              <a
                href="/publishers/blogs/<%= blog._id %>/edit"
                class="font-medium text-gray-800 hover:text-indigo-600"
              >
                <%= blog.title %>
              </a>
              <p class="text-xs text-gray-400 mt-1">
                <%= new Date(blog.createdAt).toDateString() %>
              </p>
            </td>

            <!-- CATEGORIES -->
            <td class="px-6 py-4">
              <div class="flex flex-wrap gap-2">
                <% blog.categories?.forEach(cat => { %>
                  <span class="px-2.5 py-1 text-xs rounded-full bg-indigo-50 text-indigo-600">
                    <%= cat.name %>
                  </span>
                <% }) %>
              </div>
            </td>
<!-- STATUS -->
<td class="px-6 py-4 text-center">
              <% if (blog.status.publisherApprovalStatus === 'APPROVED') { %>
                <span class="px-2.5 py-1 text-xs rounded-full bg-green-50 text-green-600">
                  Approved
                </span>
              <% } else if (blog.status.publisherApprovalStatus === 'PENDING') { %>
                <span class="px-2.5 py-1 text-xs rounded-full bg-yellow-50 text-yellow-600">
                  Pending
                </span>
              <% } else { %>
                <span class="px-2.5 py-1 text-xs rounded-full bg-red-50 text-red-600">
                  Rejected
                </span>
              <% } %>
</td>





            <!-- STATS -->
            <td class="px-6 py-4 text-center">
              <% if (blog.status.publisherApprovalStatus === 'APPROVED') { %>
                <div class="flex justify-center gap-4 text-gray-600">
                  <span><i class="fa-regular fa-eye"></i> <%= blog.stats.views %></span>
                  <span><i class="fa-regular fa-heart"></i> <%= blog.likeCount %></span>
                  <span><i class="fa-regular fa-comment"></i> <%= blog.commentCount %></span>
                  <span><i class="fa-regular fa-bookmark"></i> <%= blog.bookmarkCount %></span>
                </div>
              <% } else { %>
                <span class="text-xs text-gray-400">
                  Locked
                </span>
              <% } %>
            </td>

            <!-- Update Icon -->
             <td class="px-6 py-4 text-center">
              <a href="/authors/blogs/<%= blog._id %>/edit" class="text-indigo-600 hover:text-blue-600">
                <i class="fa-solid fa-pen"></i>
              </a>
             </td>

          </tr>
        <% }) %>

        

      </tbody>
    </table>

    <!-- PAGINATION -->
    <div class="flex items-center justify-between px-6 py-4 border-t text-sm">
      <p class="text-gray-500">
        Page <%= blogs.page %> of <%= blogs.totalPages %>
      </p>

      <div class="flex gap-2">
        <% if (blogs.hasPrevPage) { %>
          <a href="?page=<%= blogs.prevPage %>" class="btn inline-flex items-center px-4 py-2
         text-sm font-medium text-gray-700
         bg-white border border-gray-300
         rounded-lg
         hover:bg-gray-100
         focus:outline-none focus:ring-2 focus:ring-indigo-400
         transition"> ← Prev</a>
        <% } %>

        <% if (blogs.hasNextPage) { %>
          <a href="?page=<%= blogs.nextPage %>" class="btn inline-flex items-center px-4 py-2
         text-sm font-medium text-gray-700
         bg-white border border-gray-300
         rounded-lg
         hover:bg-gray-100
         focus:outline-none focus:ring-2 focus:ring-indigo-400
         transition">Next →</a>
        <% } %>
      </div>
    </div>

  </div>
        </main>

        <%- include("./components/footer.ejs", {author}) %>
      </div>
    </div>

    <%- include('../partials/toast-script.ejs') %>
    <%- include("./components/icon-hover.ejs") %>
    <%- include("./components/back-button.ejs") %>
    <%- include("./components/real-time.ejs") %>
  </body>
</html>
