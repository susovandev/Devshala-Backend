<!DOCTYPE html>
<html lang="en">
  <%- include("../partials/head.ejs") %>


  <body class="bg-gray-100 min-h-screen">
    <!-- TOAST START -->
    <%- include("../partials/toast.ejs") %>


<!-- WRAPPER -->
    <div class="flex min-h-screen">
      <!-- SIDEBAR  START -->
  <%- include("./components/sidebar.ejs", {currentPath, publisher, pageTitle}) %>


      <!-- MAIN AREA -->
<div class="flex-1 flex flex-col">
        <!-- TOP BAR -->
<%- include("./components/main-header.ejs", {publisher, totalUnreadNotifications, totalNotifications, notifications}) %>


        <!-- MAIN CONTENT -->
<!-- MAIN CONTENT -->
<main class="flex-1 p-6 space-y-6">

  <!-- PAGE HEADER -->
  <div class="flex items-center justify-between">
    <div>
      <h2 class="text-2xl font-semibold text-gray-800">Category Management</h2>
      <p class="text-sm text-gray-500">
        Create, update and organize your blog categories
      </p>
    </div>

    <!-- CREATE CATEGORY BUTTON -->
    <button
  data-open-modal="create-category"
  class="bg-indigo-600 text-white px-5 py-2.5 rounded-xl text-sm font-medium shadow
         hover:bg-indigo-700 transition flex items-center gap-2"
>
  <i class="fa-solid fa-plus"></i>
  New Category
</button>

  </div>

  <!-- CATEGORY TABLE CARD -->
  <div class="bg-white rounded-2xl shadow border overflow-hidden">

    <!-- TABLE -->
    <table class="w-full text-sm">
      <thead class="bg-gray-50 text-gray-600">
        <tr>
          <th class="px-6 py-4 text-left font-medium">Category Name</th>
          <th class="px-6 py-4 text-left font-medium">Slug</th>
          <th class="px-6 py-4 text-left font-medium">Total Blogs</th>
          <th class="px-6 py-4 text-right font-medium">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y">

  <% if (!categories.docs || categories.docs.length === 0) { %>

    <!-- EMPTY STATE -->
    <tr>
      <td colspan="4" class="px-6 py-16 text-center">
        <div class="flex flex-col items-center gap-3">

          <!-- ICON -->
          <div class="w-14 h-14 flex items-center justify-center rounded-full bg-indigo-50 text-indigo-600">
            <svg xmlns="http://www.w3.org/2000/svg"
                 class="w-7 h-7"
                 fill="none"
                 viewBox="0 0 24 24"
                 stroke="currentColor">
              <path stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
          </div>

          <!-- TEXT -->
          <h3 class="text-lg font-semibold text-gray-800">
            No categories yet
          </h3>

          <p class="text-sm text-gray-500 max-w-md">
            You haven‚Äôt created any categories. Categories help organize your blogs and
            improve discoverability.
          </p>

          <!-- CTA -->
              <button
  data-open-modal="create-category"
  class="bg-indigo-600 text-white px-5 py-2.5 rounded-xl text-sm font-medium shadow
         hover:bg-indigo-700 transition flex items-center gap-2"
>
  <i class="fa-solid fa-plus"></i>
  Create new category now
</button>

        </div>
      </td>
    </tr>

  <% } else { %>

    <!-- NORMAL LIST -->
    <% categories.docs.forEach(cat => { %>
  <tr class="hover:bg-gray-50 transition">
    
    <!-- Name -->
    <td class="px-6 py-4 font-medium text-gray-800">
      <%= cat.name %>
    </td>

    <!-- Slug -->
    <td class="px-6 py-4 text-gray-500">
      <%= cat.slug %>
    </td>

    <!-- Blog Count -->
    <td class="px-6 py-4">
      <span class="inline-flex items-center gap-1 px-3 py-1 text-xs
                   rounded-full bg-indigo-50 text-indigo-600 font-semibold">
        <%= cat.blogCount || 0 %> Blogs
      </span>
    </td>

    <!-- Actions -->
    <td class="px-6 py-4 text-right">
      <div class="inline-flex items-center gap-2">

        <!-- Edit -->
        <button
          type="button"
          data-id="<%= cat._id %>"
          data-name="<%= cat.name %>"
          class="edit-category-btn
                 flex items-center gap-2 px-4 py-1.5
                 text-sm font-semibold text-indigo-700
                 bg-indigo-50 border border-indigo-200
                 rounded-lg
                 hover:bg-indigo-100 hover:border-indigo-300
                 focus:outline-none focus:ring-2 focus:ring-indigo-400
                 transition"
        >
          ‚úèÔ∏è Edit
        </button>

        <!-- Delete -->
        <form
          action="/publishers/categories/<%= cat._id %>?_method=DELETE"
          method="POST"
          class="inline"
          onsubmit="return confirm('Are you sure you want to delete this category?')"
        >
          <button
            type="submit"
            class="flex items-center gap-2 px-4 py-1.5
                   text-sm font-semibold text-red-700
                   bg-red-50 border border-red-200
                   rounded-lg
                   hover:bg-red-100 hover:border-red-300
                   focus:outline-none focus:ring-2 focus:ring-red-400
                   transition"
          >
            üóë Delete
          </button>
        </form>

      </div>
    </td>

  </tr>
<% }) %>

  <% } %>

</tbody>

    </table>

    <!-- PAGINATION -->
    <div class="flex items-center justify-between px-6 py-4 border-t text-sm">
      <p class="text-gray-500">
        Page <%= categories.page %> of <%= categories.totalPages %>
      </p>

      <div class="flex gap-2">
        <% if (categories.hasPrevPage) { %>
                                      <a
  href="?page=<%= categories.prevPage %>"
  class="inline-flex items-center px-4 py-2
         text-sm font-medium text-gray-700
         bg-white border border-gray-300
         rounded-lg
         hover:bg-gray-100
         focus:outline-none focus:ring-2 focus:ring-indigo-400
         transition"
>
  ‚Üê Prev
</a>
        <% } %>

        <% if (categories.hasNextPage) { %>
                        <a
  href="?page=<%= categories.nextPage %>"
  class="inline-flex items-center px-4 py-2
         text-sm font-medium text-gray-700
         bg-white border border-gray-300
         rounded-lg
         hover:bg-gray-100
         focus:outline-none focus:ring-2 focus:ring-indigo-400
         transition"
>
  Next ‚Üí
</a>
        <% } %>
      </div>
    </div>
  </div>
</main>



        <!-- FOOTER -->
<%- include("./components/footer.ejs") %>


      </div>
    </div>
    
    <!-- CREATE CATEGORY MODAL -->
<div
   id="create-category-modal"
  class="modal fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm"
>
  <div
    class="bg-white w-full max-w-md rounded-2xl shadow-2xl p-6 animate-scale-in"
  >
    <!-- HEADER -->
    <div class="flex items-center justify-between mb-5">
      <h3 class="text-lg font-semibold text-gray-800">
        Create New Category
      </h3>
      <button
  data-open-modal="create-category"
  class="bg-indigo-600 text-white px-5 py-2.5 rounded-xl text-sm font-medium shadow
         hover:bg-indigo-700 transition flex items-center gap-2"
>
  <i class="fa-solid fa-tag"></i>
  New Category
</button>
    </div>

    <!-- FORM -->
    <form action="/publishers/categories" method="POST" class="space-y-5">

      <!-- INPUT -->
      <div>
        <label class="block text-sm font-medium text-gray-600 mb-1">
          Category Name
        </label>

        <div class="relative">
          <input
            type="text"
            name="name"
            required
            placeholder="e.g. Technology"
            class="w-full rounded-xl border border-gray-300 bg-white px-4 py-3
                   text-sm focus:border-indigo-500 focus:ring-2 focus:ring-indigo-200
                   transition"
          />
          <i class="fa-solid fa-tag absolute right-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
        </div>
      </div>

      <!-- ACTIONS -->
      <div class="flex justify-end gap-3 pt-3">
        <button
          type="button"
          data-close-modal
          class="px-4 py-2 rounded-lg border border-gray-300 text-gray-600
                 hover:bg-gray-100 transition"
        >
          Cancel
        </button>

        <button
          type="submit"
          class="px-5 py-2 rounded-lg bg-indigo-600 text-white
                 hover:bg-indigo-700 transition font-medium"
        >
          Create Category
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Update CATEGORY MODAL -->
<div
   id="editCategoryModal" class="fixed inset-0 z-50 hidden flex items-center justify-center bg-black/40"
>
  <div class="bg-white rounded-2xl w-full max-w-md p-6 shadow-xl">

    <h3 class="text-lg font-semibold mb-4">Update Category</h3>

    <form id="editCategoryForm" method="POST" class="space-y-4">
      <input type="hidden" name="_method" value="PUT" />

      <div>
        <label class="text-sm font-medium text-gray-700 mb-1 block">
          Category Name
        </label>
        <input
          id="editCategoryName"
          type="text"
          name="name"
          required
          class="w-full px-4 py-2.5 rounded-xl bg-gray-50 border
                 focus:bg-white focus:ring-2 focus:ring-indigo-500"
        />
      </div>

      <div class="flex justify-end gap-3 pt-4">
        <button
          type="button"
          onclick="closeEditModal()"
          class="px-4 py-2 rounded-lg border"
        >
          Cancel
        </button>
        <button
          class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700"
        >
          Update
        </button>
      </div>
    </form>
  </div>
</div>



<!-- SCRIPT for create category -->
<script>
  document.addEventListener('DOMContentLoaded', () => {

    // OPEN MODAL
    document.querySelectorAll('[data-open-modal]').forEach(button => {
      button.addEventListener('click', () => {
        const modalKey = button.dataset.openModal;
        const modal = document.getElementById(`${modalKey}-modal`);

        if (!modal) return;

        modal.classList.remove('hidden');
        modal.classList.add('flex');
      });
    });

    // CLOSE MODAL
    document.querySelectorAll('[data-close-modal]').forEach(button => {
      button.addEventListener('click', () => {
        const modal = button.closest('.modal');

        modal.classList.add('hidden');
        modal.classList.remove('flex');
      });
    });

    // CLOSE ON BACKDROP CLICK
    document.querySelectorAll('.modal').forEach(modal => {
      modal.addEventListener('click', (e) => {
        if (e.target === modal) {
          modal.classList.add('hidden');
          modal.classList.remove('flex');
        }
      });
    });

  });
</script>

<!-- SCRIPT for update category -->
<script>
document.addEventListener('DOMContentLoaded', () => {

  const editModal = document.getElementById('editCategoryModal');
  const editForm  = document.getElementById('editCategoryForm');
  const editInput = document.getElementById('editCategoryName');

  // OPEN EDIT MODAL
  document.querySelectorAll('.edit-category-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const id   = btn.dataset.id;
      const name = btn.dataset.name;

      editInput.value = name;
      editForm.action = `/publishers/categories/${id}?_method=PUT`;

      editModal.classList.remove('hidden');
      editModal.classList.add('flex');
    });
  });

  // CLOSE MODAL ON BACKDROP
  editModal.addEventListener('click', (e) => {
    if (e.target === editModal) {
      editModal.classList.add('hidden');
      editModal.classList.remove('flex');
    }
  });
});

// CLOSE FUNCTION (used by cancel button)
function closeEditModal() {
  const modal = document.getElementById('editCategoryModal');
  modal.classList.add('hidden');
  modal.classList.remove('flex');
}
</script>

    <%- include('../partials/toast-script.ejs') %>
    <%- include("./components/icon-hover.ejs") %>
    <%- include("./components/back-button.ejs") %>
    <%- include("./components/real-time.ejs") %>
  </body>
</html>
